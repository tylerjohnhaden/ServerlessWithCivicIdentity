<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Serverless + Civic Identity</title>

    <link rel="stylesheet" href="https://hosted-sip.civic.com/css/civic-modal.min.css">
    <link rel="icon" href="waffle.png">
</head>
<body>
    <h1>
        Welcome! If you would like the super secret sauce,
        <button id="signupButton" type="button" style="font-size: 100%;">
            <span>verify your identity with Civic</span>
        </button>
    </h1>

    <p id="super-secret"></p>
</body>

<script src="https://hosted-sip.civic.com/js/civic.sip.min.js"></script>
<script>

    const apiPath = 'https://test.tylerjohnhaden.com';
    const appId = 'pfdsARzpj';

    const civicSip = new civic.sip({ appId });
    const button = document.querySelector('#signupButton');

    button.addEventListener('click', function () {
        civicSip.signup({ style: 'popup', scopeRequest: civicSip.ScopeRequests.ANONYMOUS_LOGIN });
    });

    function exchangeCodeForSecretSauce(token) {

        // setup new http request
        const xmlhttp = new XMLHttpRequest();
        xmlhttp.open("GET", apiPath + '/super-secret-sauce');
        xmlhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");

        // you can pass the token using the "Authorization" header, body, or a custom header
        xmlhttp.setRequestHeader('Authorization', token);

        xmlhttp.onload = () => {
            // display results
            document.querySelector('#super-secret').innerHTML = xmlhttp.responseText;
        };

        xmlhttp.send();
    }

    civicSip.on('auth-code-received', event => {

        // receive token from Civic
        var jwtToken = event.response;

        // and pass it to your backend
        exchangeCodeForSecretSauce(jwtToken);
    });

    civicSip.on('civic-sip-error', error => {

        // display errors from civic
        console.log(`${error.type} error from Civic! :`, error.message);
        document.querySelector('#super-secret').innerHTML = error.message;
    });

</script>
</html>